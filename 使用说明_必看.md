# 🎉 LLM加密货币交易系统 - 使用说明

## ✅ 所有功能已完成

### 1️⃣ 图表时间轴自动扩展 ✅
- **问题**：图表只显示有限时间的数据
- **解决**：数据持久化，重启后图表显示完整历史
- **效果**：第一次运行60分钟 → 关闭 → 第二次运行30分钟 = 图表显示90分钟完整数据

### 2️⃣ 去掉数据点圆圈 ✅
- **问题**：折线图圆圈太多，看不清楚
- **解决**：设置 `pointRadius: 0`
- **效果**：折线清晰，鼠标悬停仍可看到数值

### 3️⃣ 持仓和交易分开显示 ✅
- **状态**：本来就是两个独立卡片
- **显示**：Open Positions + Recent Trades（右侧两个卡片）

### 4️⃣ 数据持久化 + Restart参数 ✅
- **问题**：重启丢失所有数据
- **解决**：自动保存/恢复 + `--restart` 参数
- **文件**：`trading_data.json`

---

## 🚀 快速启动

### Windows 批处理

```bash
# 继续上次运行（默认）
START_ADVANCED.bat

# 从头开始（清空数据）
START_ADVANCED.bat --restart
```

### Python 直接运行

```bash
# 继续上次运行
python main_advanced.py

# 从头开始
python main_advanced.py --restart
```

---

## 📊 功能说明

### 继续模式（默认）

```bash
python main_advanced.py
```

**自动恢复：**
- ✅ 账户资金
- ✅ 持仓位置
- ✅ 交易历史
- ✅ 价格历史（图表）
- ✅ 账户价值历史（图表）

**控制台提示：**
```
✅ State loaded from trading_data.json
   Saved at: 2025-10-24T15:30:45
   Iteration: 42
   Capital: $1025.50
   Open Positions: 2
   Trade History: 15 trades
✅ Resumed from saved state
```

---

### 重启模式（--restart）

```bash
python main_advanced.py --restart
```

**效果：**
- 🔄 删除 `trading_data.json`
- 🆕 从 $1000 初始资金开始
- 📊 图表从零开始
- 📝 交易历史清空

**控制台提示：**
```
🔄 Restart mode: Clearing saved state...
✅ Deleted saved state: trading_data.json
🆕 Starting fresh (restart mode)
```

---

## 💾 自动保存时机

### 1. 按 Ctrl+C 退出
```
按 Ctrl+C
→ "Saving state..."
→ 自动保存所有数据
→ 正常退出
```

### 2. 程序正常关闭
```
程序结束
→ shutdown()
→ "Saving state..."
→ 自动保存
```

### 3. 异常情况
- ⚠️ 强制关闭（kill）可能丢失最近数据
- ⚠️ 断电可能丢失最近数据
- ✅ 大部分情况数据都会保存

---

## 📁 数据文件

### 位置
```
D:\workspace\llmtrading\trading_data.json
```

### 内容
```json
{
  "timestamp": "2025-10-24T15:30:45",
  "iteration_count": 42,
  "simulator": {
    "initial_capital": 1000.0,
    "capital": 1025.50,
    "open_positions": [...]
,
    "trade_history": [...]
  },
  "value_history": [...],
  "price_history": {...}
}
```

### 手动操作
```bash
# 查看数据
type trading_data.json

# 删除数据（效果同 --restart）
del trading_data.json

# 备份数据
copy trading_data.json backup\trading_data_backup.json
```

---

## 🎯 使用场景

### 场景1：日常运行
```bash
# 每天启动
python main_advanced.py
# ✅ 自动恢复昨天的状态
# ✅ 图表显示累积的所有历史
```

### 场景2：测试新策略
```bash
# 清空数据，干净测试
python main_advanced.py --restart
```

### 场景3：调试程序
```bash
# 第一次运行
python main_advanced.py --restart
# 发现bug，Ctrl+C退出（自动保存）

# 修改代码...

# 重新测试
python main_advanced.py --restart
```

### 场景4：程序崩溃恢复
```bash
# 程序意外关闭

# 重新启动
python main_advanced.py
# ✅ 自动恢复到关闭前的状态
```

---

## 📈 Web界面说明

### 访问地址
```
http://127.0.0.1:5000
```

### 界面布局

```
┌─────────────────────────────────────────────────────────┐
│            🚀 LLM Crypto Trading Dashboard              │
├──────────────┬────────────────┬──────────────────────────┤
│              │                │                          │
│  Stats &     │  Model Chat    │  Positions & Trades      │
│  Charts      │  (QWEN3 MAX)   │                          │
│              │                │                          │
│  - Stats     │  - Summary     │  - Open Positions        │
│  - Breakdown │  - Actions     │  - Recent Trades         │
│  - Value     │  - Details     │                          │
│  - Prices    │                │                          │
│              │                │                          │
└──────────────┴────────────────┴──────────────────────────┘
```

### 图表说明

#### Account Value
- 显示账户总价值随时间变化
- **时间轴：自动扩展，显示从最开始到现在的所有数据**
- **数据点：无圆圈（鼠标悬停显示）**

#### Price Change (%)
- 显示各币种价格变化百分比
- **时间轴：自动扩展，显示完整历史**
- **数据点：无圆圈（鼠标悬停显示）**

---

## ⚙️ 配置调整

### Sleep Time（循环间隔）
**位置**：`main_advanced.py` 第254行
```python
bot.run(sleep_seconds=30)  # 改为你想要的秒数
```

### LLM决策间隔
**位置**：`config.py`
```python
DECISION_INTERVAL = 300  # 改为你想要的秒数
```

### 更多配置
参考：`CONFIGURATION_GUIDE.md`

---

## 📝 检查清单

### 启动前检查
- [ ] API key已设置（`.env` 文件）
- [ ] Conda环境已激活
- [ ] 确定使用继续模式还是重启模式

### 运行中检查
- [ ] Web界面可以访问（http://127.0.0.1:5000）
- [ ] 图表正常显示
- [ ] Model Chat有LLM决策
- [ ] 持仓信息正确

### 关闭前检查
- [ ] 使用 Ctrl+C 退出（自动保存）
- [ ] 看到 "Saving state..." 提示
- [ ] 看到 "✅ State saved" 提示

### 重启后检查
- [ ] 看到 "✅ State loaded" 提示
- [ ] 资金金额正确
- [ ] 持仓数量正确
- [ ] 图表显示完整历史

---

## ❓ 常见问题

### Q1: 图表为什么只显示部分数据？
**A:** 刷新浏览器，确保加载最新代码。

### Q2: Restart后图表还显示旧数据？
**A:** 确保使用了 `--restart` 参数启动。

### Q3: 关闭程序后数据丢失？
**A:** 使用 Ctrl+C 退出，不要强制关闭。

### Q4: 如何查看保存的数据？
**A:** 打开 `trading_data.json` 文件（JSON格式）。

### Q5: 数据文件会越来越大吗？
**A:** 会的。定期使用 `--restart` 或手动删除文件。

### Q6: 可以手动修改数据吗？
**A:** 可以，但要注意JSON格式正确。

### Q7: 如何备份数据？
**A:** 复制 `trading_data.json` 到其他位置。

### Q8: 修改配置后需要restart吗？
**A:** 如果修改了初始资金等，建议 `--restart`。

---

## 🎉 总结

### 已解决的问题

| 问题 | 状态 |
|------|------|
| 图表时间范围受限 | ✅ 完成 |
| 数据点圆圈太多 | ✅ 完成 |
| Positions/Trades未分开 | ✅ 已有 |
| 重启丢失数据 | ✅ 完成 |

### 核心功能

| 功能 | 命令 |
|------|------|
| 继续运行 | `python main_advanced.py` |
| 重新开始 | `python main_advanced.py --restart` |
| 查看界面 | http://127.0.0.1:5000 |

### 文档指南

| 文档 | 说明 |
|------|------|
| `使用说明_必看.md` | **本文档** - 快速上手指南 |
| `QUICK_START_RESTART.md` | 快速启动参考 |
| `PERSISTENCE_GUIDE.md` | 数据持久化详细说明 |
| `CONFIGURATION_GUIDE.md` | 配置参数调整指南 |
| `UPDATES_SUMMARY.md` | 更新总结和技术细节 |
| `TRADING_CONCEPTS.md` | Long/Short 交易概念 |

---

## 🚀 立即开始

### 第一次使用
```bash
python main_advanced.py
# 程序自动检测：没有保存数据，从头开始
```

### 后续使用（继续）
```bash
python main_advanced.py
# ✅ 自动加载上次状态
# ✅ 图表显示完整历史
```

### 后续使用（重新开始）
```bash
python main_advanced.py --restart
# 🔄 清空数据
# 🆕 从头开始
```

---

## 💰 开始交易吧！

```
╔════════════════════════════════════════════════════════════╗
║    Advanced LLM Crypto Trading Bot with Model Chat        ║
║                                                            ║
║  Web Dashboard: http://127.0.0.1:5000                     ║
║  - Left: Stats & Charts                                   ║
║  - Middle: Model Chat (QWEN3 MAX)                         ║
║  - Right: Positions & Trades                              ║
║                                                            ║
║  Press Ctrl+C in terminal to stop                         ║
║                                                            ║
║  Options:                                                  ║
║    --restart    Start fresh, clear saved state            ║
╚════════════════════════════════════════════════════════════╝
```

**祝交易顺利！** 🚀💰📈

