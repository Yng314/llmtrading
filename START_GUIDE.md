# 🚀 启动指南

## ✅ 修复说明

已修复以下问题：
1. ✅ **价格图表水平线问题** - 改为显示百分比变化（%），所有币种从0%开始
2. ✅ **Ctrl+C无法退出** - 改进信号处理，防止重复触发

## 📋 启动步骤

### 方法1：推荐 - 使用虚拟环境

```powershell
# 1. 激活虚拟环境
conda activate d:\workspace\llmtrading\.conda

# 2. 启动程序
python main_with_web.py
```

### 方法2：快速启动

双击运行 `START_WEB.bat` 文件

### 方法3：直接运行（如果环境已配置）

```powershell
python main_with_web.py
```

## 🌐 访问Dashboard

启动后，打开浏览器访问：
```
http://127.0.0.1:5000
```

## 📊 改进后的价格图表

**之前的问题：**
```
BTC: $110,000+ │ ════════════ (占满整个Y轴)
ETH: $3,000+   │ ─────────── (看起来像直线)
BNB: $1,000+   │ ─────────── (看起来像直线)
ADA: $0.65     │ ─────────── (完全看不见)
```

**现在的显示：**
```
所有币种都显示从开始到现在的百分比变化：

+2.5% │     BTC ╱╲
      │    ╱    ╲
+1.0% │ ETH      ╲
      │             
 0.0% │─────────────────
      │          BNB
-1.0% │         ╱
      │  ADA  ╱
-2.5% │
```

**优势：**
- ✅ 所有币种在同一范围内显示
- ✅ 容易比较各币种的涨跌幅
- ✅ 趋势清晰可见
- ✅ Y轴显示百分比（如 +2.50%）

## 🛑 如何正确退出

### 在终端中
按 `Ctrl+C` 一次，程序会：
1. 显示 "Received shutdown signal..."
2. 平掉所有持仓
3. 生成最终报告
4. 自动退出

**注意：只需按一次！** 如果按多次可能会强制退出，跳过清理过程。

### 如果程序卡住
如果Ctrl+C后超过10秒还没退出：
1. 再按一次 `Ctrl+C` 强制退出
2. 或直接关闭终端窗口

## 🐛 常见问题

### Q1: 图表还是显示为直线？
**解决方法：**
1. 刷新浏览器（Ctrl+F5 强制刷新）
2. 清除浏览器缓存
3. 等待几分钟让数据积累

### Q2: 提示 "ModuleNotFoundError: No module named 'dotenv'"
**解决方法：**
```powershell
conda activate d:\workspace\llmtrading\.conda
pip install python-dotenv
```

### Q3: Dashboard显示 "No open positions" 但终端显示有持仓
**解决方法：**
- 等待2-3秒，数据会自动更新
- 检查浏览器控制台（F12）是否有错误

### Q4: 端口5000被占用
**解决方法：**
编辑 `main_with_web.py`，修改端口：
```python
run_server(host='127.0.0.1', port=8080, debug=False)
```
然后访问 `http://127.0.0.1:8080`

## 📸 预期效果

启动后你应该看到：

**终端：**
```
╔════════════════════════════════════════════════════════════╗
║    LLM-Powered Cryptocurrency Trading Bot with Web UI     ║
║                                                            ║
║  Web Dashboard: http://127.0.0.1:5000                     ║
╚════════════════════════════════════════════════════════════╝

🌐 Starting web dashboard on http://127.0.0.1:5000
📊 Open this URL in your browser to view the dashboard

=== Trading Session Started ===
=== Trading Bot Started ===
...
```

**浏览器：**
- 顶部显示 "Running" 🟢 和最后更新时间
- 统计卡片实时显示总价值、P&L、ROI
- **价格图表显示百分比变化**（不再是直线！）
- 右侧显示持仓和交易历史

## 🎨 图表说明

### Account Value 图表
- 显示账户总价值的绝对金额（$）
- 反映整体盈亏情况

### Price Change (%) 图表
- 显示各币种相对于第一个数据点的涨跌幅
- 所有币种从0%开始
- 方便直接比较哪个币种涨得多/跌得多

**举例：**
```
如果图表显示：
- BTC: +1.2%
- ETH: -0.5%
- BNB: +2.3%

说明从开始到现在：
- BTC 涨了 1.2%
- ETH 跌了 0.5%
- BNB 涨了 2.3%（表现最好）
```

## ✨ 使用建议

1. **让程序运行一段时间**（至少5-10分钟）
   - 数据越多，图表越有意义
   - 能看到完整的价格波动

2. **观察百分比变化**
   - 正值（绿色区域）= 币种在涨
   - 负值（红色区域）= 币种在跌
   - 斜率越陡 = 波动越大

3. **结合持仓信息**
   - 如果持有做多仓位，希望看到该币种曲线向上
   - 如果持有做空仓位，希望看到该币种曲线向下

4. **监控ROI**
   - ROI是最终指标
   - 正ROI = 盈利
   - 负ROI = 亏损

## 🎯 现在就开始！

```powershell
conda activate d:\workspace\llmtrading\.conda
python main_with_web.py
```

然后打开浏览器：**http://127.0.0.1:5000**

享受可视化交易体验！🚀📈

